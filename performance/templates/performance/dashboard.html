{% extends 'performance/base.html' %}

{% block title %}Dashboard - Performance Management System{% endblock %}

{% block content %}
<div class="container-fluid py-4">
    <!-- Enhanced Welcome Section -->
    <div class="welcome-hero mb-4">
        <div class="welcome-content p-4">
            <div class="row align-items-center">
                <div class="col-md-8">
                    <h1 class="display-5 fw-bold text-primary mb-2">Welcome, {{ user.get_full_name }}</h1>
                    <p class="lead text-secondary mb-3">{{ user.get_role_display }} | {{ user.department|default:"Department not set" }}</p>
                    <p class="text-muted">
                        You have 
                        <span class="badge bg-primary">{{ performance_agreements.count }}</span> performance agreements,
                        <span class="badge bg-info">{{ reviews.count }}</span> mid-year reviews, and
                        <span class="badge bg-success">{{ development_plans.count }}</span> development plans.
                    </p>
                    <div class="mt-3">
                        <a href="{% url 'performance:performance_agreement_create' %}" class="btn btn-primary me-2">
                            <i class="bi bi-plus-circle"></i> New Agreement
                        </a>
                        <a href="{% url 'performance:profile' %}" class="btn btn-outline-secondary">
                            <i class="bi bi-person"></i> View Profile
                        </a>
                    </div>
                </div>
                <div class="col-md-4 d-none d-md-block text-end">
                    <div class="welcome-icon">
                        <i class="bi bi-bar-chart-line text-primary"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Performance Agreements -->
    <div class="card mb-4">
        <div class="card-header d-flex justify-content-between align-items-center">
            <h5 class="mb-0">Performance Agreements</h5>
            <a href="{% url 'performance:performance_agreement_create' %}" class="btn btn-primary btn-sm">
                <i class="bi bi-plus"></i> New Agreement
            </a>
        </div>
        <div class="card-body">
            {% if performance_agreements %}
                <div class="table-responsive">
                    <table class="table table-hover">
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for agreement in performance_agreements %}
                            <tr>
                                <td>{{ agreement.agreement_date|date:"M d, Y" }}</td>
                                <td><span class="badge bg-{{ agreement.status|lower }}">{{ agreement.get_status_display }}</span></td>
                                <td>
                                    <a href="{% url 'performance:performance_agreement_detail' agreement.id %}" class="btn btn-sm btn-outline-primary">
                                        <i class="bi bi-eye"></i> View
                                    </a>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            {% else %}
                <div class="alert alert-info">
                    <i class="bi bi-info-circle"></i> No performance agreements found.
                    <a href="{% url 'performance:performance_agreement_create' %}" class="alert-link">Create your first agreement</a>.
                </div>
            {% endif %}
        </div>
    </div>
    
    {% comment %}
    <!-- The rest of the content remains unchanged -->
    <!-- Mid-Year Reviews, Year-End Reviews, Improvement Plans, Development Plans -->
    {% endcomment %}
    
    <!-- Mid-Year Reviews -->
    <div class="card mb-4">
        <div class="card-header d-flex justify-content-between align-items-center">
            <h5 class="mb-0">Mid-Year Reviews</h5>
            <a href="{% url 'performance:midyear_review_create' %}" class="btn btn-primary btn-sm">
                <i class="bi bi-plus"></i> New Review
            </a>
        </div>
        <div class="card-body">
            {% if reviews %}
                <div class="table-responsive">
                    <table class="table table-hover">
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>Rating</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for review in reviews %}
                            <tr>
                                <td>{{ review.review_date|date:"M d, Y" }}</td>
                                <td>{{ review.get_final_rating_display }}</td>
                                <td>
                                    <a href="{% url 'performance:midyear_review_detail' review.id %}" class="btn btn-sm btn-outline-primary">
                                        <i class="bi bi-eye"></i> View
                                    </a>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            {% else %}
                <div class="alert alert-info">
                    <i class="bi bi-info-circle"></i> No reviews found.
                    <a href="{% url 'performance:midyear_review_create' %}" class="alert-link">Create your first review</a>.
                </div>
            {% endif %}
        </div>
    </div>

    <!-- Year-End Reviews -->
    <div class="card mb-4">
        <div class="card-header d-flex justify-content-between align-items-center">
            <h5 class="mb-0">Year-End Reviews</h5>
            <a href="{% url 'performance:final_review_create' %}" class="btn btn-primary btn-sm">
                <i class="bi bi-plus"></i> New Review
            </a>
        </div>
        <div class="card-body">
            {% if final_reviews %}
                <div class="table-responsive">
                    <table class="table table-hover">
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>Rating</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for review in final_reviews %}
                            <tr>
                                <td>{{ review.review_date|date:"M d, Y" }}</td>
                                <td>{{ review.calculate_overall_rating }}</td>
                                <td><span class="badge bg-{{ review.status|lower }}">{{ review.get_status_display }}</span></td>
                                <td>
                                    <a href="{% url 'performance:final_review_detail' review.id %}" class="btn btn-sm btn-outline-primary">
                                        <i class="bi bi-eye"></i> View
                                    </a>
                                    {% if review.can_edit %}
                                    <a href="{% url 'performance:final_review_update' review.id %}" class="btn btn-sm btn-outline-secondary">
                                        <i class="bi bi-pencil"></i> Edit
                                    </a>
                                    {% endif %}
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            {% else %}
                <div class="alert alert-info">
                    <i class="bi bi-info-circle"></i> No year-end reviews found.
                    <a href="{% url 'performance:final_review_create' %}" class="alert-link">Create your first year-end review</a>.
                </div>
            {% endif %}
        </div>
    </div>

    <!-- Improvement Plans -->
    <div class="card mb-4">
        <div class="card-header d-flex justify-content-between align-items-center">
            <h5 class="mb-0">Improvement Plans</h5>
            <a href="{% url 'performance:improvement_plan_create' %}" class="btn btn-primary btn-sm">
                <i class="bi bi-plus"></i> New Plan
            </a>
        </div>
        <div class="card-body">
            {% if improvement_plans %}
                <div class="table-responsive">
                    <table class="table table-hover">
                        <thead>
                            <tr>
                                <th>Area</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for plan in improvement_plans %}
                            <tr>
                                <td>{{ plan.area_for_development }}</td>
                                <td><span class="badge bg-{{ plan.status|lower }}">{{ plan.get_status_display }}</span></td>
                                <td>
                                    <a href="{% url 'performance:improvement_plan_detail' plan.id %}" class="btn btn-sm btn-outline-primary">
                                        <i class="bi bi-eye"></i> View
                                    </a>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            {% else %}
                <div class="alert alert-info">
                    <i class="bi bi-info-circle"></i> No improvement plans found.
                    <a href="{% url 'performance:improvement_plan_create' %}" class="alert-link">Create your first plan</a>.
                </div>
            {% endif %}
        </div>
    </div>

    <!-- Development Plans -->
    <div class="card">
        <div class="card-header d-flex justify-content-between align-items-center">
            <h5 class="mb-0">Development Plans</h5>
            <a href="{% url 'performance:development_plan_create' %}" class="btn btn-primary btn-sm">
                <i class="bi bi-plus"></i> New Plan
            </a>
        </div>
        <div class="card-body">
            {% if development_plans %}
                <div class="table-responsive">
                    <table class="table table-hover">
                        <thead>
                            <tr>
                                <th>Competency Gap</th>
                                <th>Progress</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for plan in development_plans %}
                            <tr>
                                <td>{{ plan.competency_gap }}</td>
                                <td>
                                    <div class="progress">
                                        <div class="progress-bar {% if plan.progress >= 100 %}bg-success{% endif %}" 
                                             role="progressbar" 
                                             style="width: {{ plan.progress }}%"
                                             aria-valuenow="{{ plan.progress }}" 
                                             aria-valuemin="0" 
                                             aria-valuemax="100">
                                            {{ plan.progress }}%
                                        </div>
                                    </div>
                                </td>
                                <td>
                                    <a href="{% url 'performance:development_plan_detail' plan.id %}" class="btn btn-sm btn-outline-primary">
                                        <i class="bi bi-eye"></i> View
                                    </a>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            {% else %}
                <div class="alert alert-info">
                    <i class="bi bi-info-circle"></i> No development plans found.
                    <a href="{% url 'performance:development_plan_create' %}" class="alert-link">Create your first plan</a>.
                </div>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}

{% block extra_css %}
<style>
    .welcome-hero {
        background: linear-gradient(135deg, #ffffff 0%, #f0f7ff 100%);
        border-radius: var(--border-radius);
        box-shadow: var(--box-shadow);
        overflow: hidden;
        position: relative;
        transition: all 0.3s ease;
        animation: fadeIn 0.5s ease-out;
    }
    
    .welcome-hero:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
    }
    
    .welcome-content {
        position: relative;
        z-index: 2;
    }
    
    .welcome-icon {
        font-size: 6rem;
        opacity: 0.2;
        position: absolute;
        right: 2rem;
        top: 50%;
        transform: translateY(-50%);
    }
    
    .welcome-icon i {
        font-size: 8rem;
    }
    
    @media (max-width: 768px) {
        .welcome-hero {
            text-align: center;
        }
        
        .welcome-icon {
            display: none;
        }
    }
</style>
{% endblock %}
