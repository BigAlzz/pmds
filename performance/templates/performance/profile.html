{% extends 'performance/base.html' %}
{% load crispy_forms_tags %}

{% block title %}Profile - Performance Management System{% endblock %}

{% block content %}
<div class="container py-4">
    <div class="row justify-content-center">
        <div class="col-md-8">
            <div class="card">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <h4 class="mb-0">Profile Information</h4>
                    <button type="button" class="btn btn-primary btn-sm" id="editButton">
                        <i class="bi bi-pencil"></i> Edit Profile
                    </button>
                </div>
                <div class="card-body">
                    <!-- View Mode -->
                    <div id="viewMode" class="d-block">
                        <div class="row mb-3">
                            <div class="col-md-4">
                                <strong>Full Name:</strong>
                            </div>
                            <div class="col-md-8">
                                {{ user.get_full_name }}
                            </div>
                        </div>
                        <div class="row mb-3">
                            <div class="col-md-4">
                                <strong>Employee ID:</strong>
                            </div>
                            <div class="col-md-8">
                                {{ user.employee_id }}
                            </div>
                        </div>
                        <div class="row mb-3">
                            <div class="col-md-4">
                                <strong>Persal Number:</strong>
                            </div>
                            <div class="col-md-8">
                                {{ user.persal_number }}
                            </div>
                        </div>
                        <div class="row mb-3">
                            <div class="col-md-4">
                                <strong>Department:</strong>
                            </div>
                            <div class="col-md-8">
                                {{ user.department }}
                            </div>
                        </div>
                        <div class="row mb-3">
                            <div class="col-md-4">
                                <strong>Job Title:</strong>
                            </div>
                            <div class="col-md-8">
                                {{ user.job_title }}
                            </div>
                        </div>
                        <div class="row mb-3">
                            <div class="col-md-4">
                                <strong>Salary Level:</strong>
                            </div>
                            <div class="col-md-8">
                                {% if user.salary_level %}
                                    {{ user.salary_level }}
                                    <div class="small text-muted">
                                        <strong>Typical Roles:</strong> {{ user.salary_level.typical_titles }}<br>
                                        <strong>Notes:</strong> {{ user.salary_level.notes }}
                                    </div>
                                {% else %}
                                    Not specified
                                {% endif %}
                            </div>
                        </div>
                        <div class="row mb-3">
                            <div class="col-md-4">
                                <strong>Job Purpose:</strong>
                            </div>
                            <div class="col-md-8">
                                {{ user.job_purpose }}
                            </div>
                        </div>
                        <div class="row mb-3">
                            <div class="col-md-4">
                                <strong>School/Directorate/Sub-Directorate:</strong>
                            </div>
                            <div class="col-md-8">
                                {{ user.school_directorate }}
                            </div>
                        </div>
                        <div class="row mb-3">
                            <div class="col-md-4">
                                <strong>Date of Appointment:</strong>
                            </div>
                            <div class="col-md-8">
                                {{ user.date_of_appointment|date:"M d, Y" }}
                            </div>
                        </div>
                        <div class="row mb-3">
                            <div class="col-md-4">
                                <strong>Email:</strong>
                            </div>
                            <div class="col-md-8">
                                {{ user.email }}
                            </div>
                        </div>
                        <div class="row mb-3">
                            <div class="col-md-4">
                                <strong>On Probation:</strong>
                            </div>
                            <div class="col-md-8">
                                {{ user.is_on_probation|yesno:"Yes,No" }}
                            </div>
                        </div>
                    </div>

                    <!-- Edit Mode -->
                    <div id="editMode" class="d-none">
                        <form method="post" class="form">
                            {% csrf_token %}
                            {{ form|crispy }}
                            <div class="mt-4">
                                <button type="submit" class="btn btn-primary">
                                    <i class="bi bi-save"></i> Save Changes
                                </button>
                                <button type="button" class="btn btn-secondary" id="cancelButton">
                                    <i class="bi bi-x"></i> Cancel
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const viewMode = document.getElementById('viewMode');
    const editMode = document.getElementById('editMode');
    const editButton = document.getElementById('editButton');
    const cancelButton = document.getElementById('cancelButton');
    
    function toggleEditMode() {
        if (viewMode.classList.contains('d-block')) {
            viewMode.classList.replace('d-block', 'd-none');
            editMode.classList.replace('d-none', 'd-block');
            editButton.style.display = 'none';
        } else {
            viewMode.classList.replace('d-none', 'd-block');
            editMode.classList.replace('d-block', 'd-none');
            editButton.style.display = 'block';
        }
    }

    editButton.addEventListener('click', toggleEditMode);
    cancelButton.addEventListener('click', toggleEditMode);

    // Show edit mode if there are form errors
    if (document.querySelector('.alert-danger')) {
        toggleEditMode();
    }
});
</script>
{% endblock %} 